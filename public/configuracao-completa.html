<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√£o Completa - Trajet√≥ria Med</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè•</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        accent: {
                            50: '#fef2f2',
                            100: '#fee2e2',
                            200: '#fecaca',
                            300: '#fca5a5',
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#dc2626',
                            700: '#b91c1c',
                            800: '#991b1b',
                            900: '#7f1d1d',
                        },
                        medical: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b',
                        }
                    },
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .gradient-medical {
            background: linear-gradient(135deg, #0ea5e9 0%, #0369a1 100%);
        }
        
        .gradient-accent {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .text-gradient {
            background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .tab-button {
            transition: all 0.3s;
            color: #6b7280;
            background: transparent;
        }
        
        .tab-button:hover {
            background: rgba(14, 165, 233, 0.1);
            color: #0284c7;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);
            color: white;
        }
        
        .course-card {
            transition: all 0.3s;
        }
        
        .course-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .ace-editor {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .section-divider {
            border-top: 2px solid #f0f0f0;
            margin: 24px 0;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Dashboard Layout -->
    <div class="min-h-screen flex">
        <!-- Sidebar -->
        <div class="w-72 gradient-medical shadow-2xl flex flex-col">
            <div class="p-8">
                <div class="flex items-center space-x-3 mb-8">
                    <span class="text-4xl">üè•</span>
                    <div class="flex flex-col">
                        <span class="text-2xl font-black text-white">Trajet√≥ria Med</span>
                        <span class="text-xs text-blue-200 font-semibold">PAINEL DE CONTROLE</span>
                    </div>
                </div>
                
                <nav class="space-y-2">
                    <a href="/" class="flex items-center gap-3 px-4 py-3.5 text-white/80 hover:bg-white/20 rounded-xl transition font-semibold">
                        <span class="text-xl">üìä</span> Vis√£o Geral
                    </a>
                    <a href="/" class="flex items-center gap-3 px-4 py-3.5 text-white/80 hover:bg-white/20 rounded-xl transition font-semibold">
                        <span class="text-xl">üì±</span> WhatsApp
                    </a>
                    <a href="/configuracao-completa.html" class="flex items-center gap-3 px-4 py-3.5 bg-white/30 backdrop-blur-sm text-white rounded-xl font-bold border-2 border-white/40">
                        <span class="text-xl">‚öôÔ∏è</span> Configura√ß√£o Bot
                    </a>
                    <a href="/configuracao-completa.html" class="flex items-center gap-3 px-4 py-3.5 text-white/80 hover:bg-white/20 rounded-xl transition font-semibold">
                        <span class="text-xl">üí¨</span> Conversas
                    </a>
                </nav>
            </div>

            <div class="mt-auto p-8">
                <div class="mb-4 p-3 bg-white/10 backdrop-blur-sm rounded-xl border border-white/20">
                    <div class="flex items-center gap-2 mb-1">
                        <div class="w-2 h-2 bg-medical-300 rounded-full animate-pulse"></div>
                        <span class="text-xs font-bold text-blue-200">STATUS DO SISTEMA</span>
                    </div>
                    <p class="text-sm font-bold text-white">Online</p>
                </div>
                <button onclick="window.location.href='/'" class="w-full px-4 py-3.5 gradient-accent rounded-xl font-bold transition hover:shadow-xl transform hover:-translate-y-1 flex items-center justify-center gap-2">
                    <span>üîô</span> Voltar ao Painel
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div class="flex-1 overflow-y-auto">
            <!-- Header -->
            <div class="glass-effect border-b border-gray-200 px-8 py-6 flex justify-between items-center sticky top-0 z-10">
                <div>
                    <h1 class="text-4xl font-black text-gradient">Configura√ß√£o Completa do Bot</h1>
                    <p class="text-sm text-gray-600 mt-1">Configure persona, cursos, fluxos, scripts e regras de neg√≥cio</p>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="px-8 pt-6 pb-4">
                <div class="bg-white rounded-xl shadow-lg p-2">
                    <div class="flex gap-2 flex-wrap">
                        <button class="tab-button active px-6 py-3 rounded-lg font-medium transition" onclick="showSection('global')">
                            üåç Global
                        </button>
                        <button class="tab-button px-6 py-3 rounded-lg font-medium transition" onclick="showSection('courses')">
                            üìö Cursos
                        </button>
                        <button class="tab-button px-6 py-3 rounded-lg font-medium transition" onclick="showSection('flows')">
                            üîÑ Fluxos de Atendimento
                        </button>
                        <button class="tab-button px-6 py-3 rounded-lg font-medium transition" onclick="showSection('scripts')">
                            üí¨ Scripts e Obje√ß√µes
                        </button>
                        <button class="tab-button px-6 py-3 rounded-lg font-medium transition" onclick="showSection('business')">
                            üíº Regras de Neg√≥cio
                        </button>
                        <button class="tab-button px-6 py-3 rounded-lg font-medium transition" onclick="showSection('advanced')">
                            üîß Avan√ßado
                        </button>
                    </div>
                </div>
            </div>

            <div id="alert-container" class="px-8"></div>
            
            <div class="p-8 pt-4">

        <!-- Section: Global -->
        <div id="section-global" class="section">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üé≠ Persona do Bot</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Bot</label>
                        <input type="text" id="bot_name" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500" placeholder="Ex: Mia">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Fun√ß√£o/Cargo</label>
                        <input type="text" id="bot_role" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500" placeholder="Ex: consultora de carreira">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Empresa</label>
                        <input type="text" id="bot_company" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500" placeholder="Ex: Trajet√≥ria Med">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tom de Voz</label>
                        <textarea id="bot_tone" rows="3" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500" placeholder="Profissional, emp√°tico, persuasivo e objetivo"></textarea>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üìù Menu Principal</h2>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Texto do Menu (quando usu√°rio iniciar ou pedir menu)</label>
                    <textarea id="menu_text" rows="15" class="w-full px-4 py-2 border rounded-lg font-mono text-sm" placeholder="Digite o menu completo aqui..."></textarea>
                    <small class="text-gray-500">Este texto ser√° enviado quando o lead disser "Oi", "Ol√°" ou pedir o menu</small>
                </div>
            </div>
        </div>

        <!-- Section: Courses -->
        <div id="section-courses" class="section hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üìö Gerenciar Cursos</h2>
                    <button onclick="addNewCourse()" class="bg-gradient-to-r from-medical-500 to-medical-600 text-white px-6 py-2 rounded-lg hover:from-medical-600 hover:to-medical-700">
                        ‚ûï Adicionar Curso
                    </button>
                </div>
                <div id="courses-list" class="space-y-4"></div>
            </div>
        </div>

        <!-- Section: Flows -->
        <div id="section-flows" class="section hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üîÑ Fluxos de Atendimento por Curso</h2>
                <p class="text-gray-600 mb-6">Configure o fluxo espec√≠fico de cada curso (identifica√ß√£o, qualifica√ß√£o, apresenta√ß√£o)</p>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Selecione o Curso</label>
                    <select id="flow_course_selector" onchange="loadFlowForCourse()" class="w-full px-4 py-2 border rounded-lg">
                        <option value="">-- Selecione um curso --</option>
                    </select>
                </div>

                <div id="flow-editor" class="hidden">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">üìã Instru√ß√µes de Fluxo</label>
                        <textarea id="flow_instructions" rows="25" class="w-full px-4 py-2 border rounded-lg font-mono text-sm" placeholder="Digite o fluxo espec√≠fico do curso...

Estrutura sugerida:
- Diferencial principal
- Passo 1: Apresenta√ß√£o
- Passo 2: Qualifica√ß√£o
- Passo 3: Argumenta√ß√£o
- Obje√ß√µes espec√≠ficas
- Instru√ß√µes de fechamento"></textarea>
                        <small class="text-gray-500">
                            ‚úÖ Suporta Markdown | 
                            ‚úÖ Este fluxo √© usado APENAS quando o lead escolhe este curso | 
                            ‚úÖ Combine com obje√ß√µes espec√≠ficas na se√ß√£o "Scripts por Curso"
                        </small>
                    </div>
                    
                    <div class="mt-4">
                        <button onclick="saveFlowForCourse()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700">
                            üíæ Salvar Fluxo
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section: Scripts -->
        <div id="section-scripts" class="section hidden">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üí¨ Scripts de Obje√ß√µes Gerais</h2>
                <p class="text-gray-600 mb-4">Scripts usados em TODOS os cursos</p>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Obje√ß√£o: "Est√° caro"</label>
                        <textarea id="objection_price" rows="3" class="w-full px-4 py-2 border rounded-lg"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Obje√ß√£o: "N√£o tenho tempo"</label>
                        <textarea id="objection_time" rows="3" class="w-full px-4 py-2 border rounded-lg"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Obje√ß√£o: "Vou estudar sozinho"</label>
                        <textarea id="objection_alone" rows="3" class="w-full px-4 py-2 border rounded-lg"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Obje√ß√£o: "Preciso pensar"</label>
                        <textarea id="objection_think" rows="3" class="w-full px-4 py-2 border rounded-lg"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Rejei√ß√£o Final (n√£o quer comprar)</label>
                        <textarea id="objection_final" rows="2" class="w-full px-4 py-2 border rounded-lg"></textarea>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üéØ Scripts por Curso</h2>
                <p class="text-gray-600 mb-4">Configure scripts espec√≠ficos para cada curso</p>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Selecione o Curso</label>
                    <select id="script_course_selector" onchange="loadScriptsForCourse()" class="w-full px-4 py-2 border rounded-lg">
                        <option value="">-- Selecione um curso --</option>
                    </select>
                </div>

                <div id="course-scripts-editor" class="hidden space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Script de Apresenta√ß√£o</label>
                        <textarea id="course_intro_script" rows="5" class="w-full px-4 py-2 border rounded-lg"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Script de Fechamento</label>
                        <textarea id="course_closing_script" rows="5" class="w-full px-4 py-2 border rounded-lg"></textarea>
                    </div>
                    
                    <div class="border-t pt-4 mt-4">
                        <h4 class="text-lg font-bold mb-3">üõ°Ô∏è Obje√ß√µes Espec√≠ficas deste Curso</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Obje√ß√£o: "Est√° caro"</label>
                                <textarea id="course_objection_expensive" rows="3" class="w-full px-4 py-2 border rounded-lg" placeholder="Resposta personalizada para este curso..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Obje√ß√£o: "N√£o tenho tempo"</label>
                                <textarea id="course_objection_no_time" rows="3" class="w-full px-4 py-2 border rounded-lg" placeholder="Resposta personalizada para este curso..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Obje√ß√£o: "Vou estudar sozinho"</label>
                                <textarea id="course_objection_alone" rows="3" class="w-full px-4 py-2 border rounded-lg" placeholder="Resposta personalizada para este curso..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Obje√ß√£o: "Preciso pensar"</label>
                                <textarea id="course_objection_think" rows="3" class="w-full px-4 py-2 border rounded-lg" placeholder="Resposta personalizada para este curso..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Rejei√ß√£o Final</label>
                                <textarea id="course_objection_final" rows="2" class="w-full px-4 py-2 border rounded-lg" placeholder="Resposta quando n√£o quer comprar..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <button onclick="saveScriptsForCourse()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700">
                            üíæ Salvar Scripts e Obje√ß√µes
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section: Business Rules -->
        <div id="section-business" class="section hidden">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üíº Regras de Neg√≥cio</h2>
                
                <div class="space-y-6">
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="text-lg font-semibold mb-2">üìÖ Per√≠odo Promocional</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Data Limite Black Friday</label>
                                <input type="date" id="promo_end_date" class="w-full px-4 py-2 border rounded-lg">
                                <small class="text-gray-500">At√© esta data usa link promocional</small>
                            </div>
                        </div>
                    </div>

                    <div class="border-l-4 border-green-500 pl-4">
                        <h3 class="text-lg font-semibold mb-2">üí≥ Formas de Pagamento</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="payment_pix" checked class="mr-2">
                                <span>PIX</span>
                            </label>
                            <div class="ml-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Chave PIX</label>
                                <input type="text" id="pix_key" class="w-full px-4 py-2 border rounded-lg" placeholder="contato@escoladepericiamedica.com.br">
                            </div>
                            <label class="flex items-center">
                                <input type="checkbox" id="payment_card" checked class="mr-2">
                                <span>Cart√£o de Cr√©dito</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="payment_subscription" checked class="mr-2">
                                <span>Assinatura (salvamento de venda)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="payment_boleto" class="mr-2">
                                <span>Boleto Banc√°rio</span>
                            </label>
                            <small class="text-red-500">‚ö†Ô∏è N√£o recomendado: Boleto geralmente est√° desativado</small>
                        </div>
                    </div>

                    <div class="border-l-4 border-yellow-500 pl-4">
                        <h3 class="text-lg font-semibold mb-2">‚è∞ Libera√ß√£o de Acesso</h3>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Mensagem de Libera√ß√£o</label>
                            <input type="text" id="access_message" class="w-full px-4 py-2 border rounded-lg" placeholder="O material ser√° liberado logo ap√≥s a confirma√ß√£o do pagamento">
                            <small class="text-gray-500">‚ö†Ô∏è NUNCA especifique tempo ("em 24h", etc)</small>
                        </div>
                    </div>

                    <div class="border-l-4 border-red-500 pl-4">
                        <h3 class="text-lg font-semibold mb-2">üö´ Limita√ß√µes e Proibi√ß√µes</h3>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="limit_no_ex_aluno_question" checked disabled class="mr-2">
                                <span>N√ÉO perguntar se √© ex-aluno (sistema detecta automaticamente)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="limit_no_email_link" checked disabled class="mr-2">
                                <span>N√ÉO oferecer envio de link por email (apenas WhatsApp)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="limit_no_hotmart" checked disabled class="mr-2">
                                <span>N√ÉO usar links do Hotmart (n√£o existem)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="limit_no_invented_discounts" checked disabled class="mr-2">
                                <span>N√ÉO inventar descontos especiais n√£o listados</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section: Advanced -->
        <div id="section-advanced" class="section hidden">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üîß Configura√ß√µes Avan√ßadas</h2>
                
                <div class="space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">ü§ñ Comportamento da IA</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Buffer de Mensagens (segundos)</label>
                                <input type="number" id="message_buffer" value="3" class="w-full px-4 py-2 border rounded-lg">
                                <small class="text-gray-500">Tempo que a IA aguarda antes de responder mensagens m√∫ltiplas</small>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Instru√ß√µes Adicionais para IA</label>
                                <textarea id="ai_additional_instructions" rows="8" class="w-full px-4 py-2 border rounded-lg font-mono text-sm" placeholder="Adicione qualquer instru√ß√£o extra que a IA deve seguir..."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <div>
                        <h3 class="text-lg font-semibold mb-2">üë• Vendedores para Notifica√ß√£o</h3>
                        <div id="vendors-list" class="space-y-4"></div>
                        <button onclick="addVendor()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                            ‚ûï Adicionar Vendedor
                        </button>
                    </div>

                    <div class="section-divider"></div>

                    <div>
                        <h3 class="text-lg font-semibold mb-2">üîê Sistema de Ex-Alunos</h3>
                        <label class="flex items-center mb-2">
                            <input type="checkbox" id="enable_alumni_system" checked class="mr-2">
                            <span>Ativar sistema de detec√ß√£o de ex-alunos</span>
                        </label>
                        <small class="text-gray-500">Quando ativo, o bot pode oferecer descontos para ex-alunos automaticamente</small>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üì§ Exportar/Importar Configura√ß√£o</h2>
                <div class="space-y-4">
                    <div>
                        <button onclick="exportConfig()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                            üì• Exportar Configura√ß√£o (JSON)
                        </button>
                        <small class="block mt-2 text-gray-500">Baixe todas as configura√ß√µes em formato JSON</small>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Importar Configura√ß√£o</label>
                        <input type="file" id="import_file" accept=".json" onchange="importConfig()" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-medical-50 file:text-medical-700 hover:file:bg-medical-100">
                    </div>
                </div>
            </div>
        </div>

        <!-- Save Button (Fixed Bottom) -->
        <div class="fixed bottom-6 right-6 z-50">
            <button onclick="saveAllConfig()" class="bg-gradient-to-r from-medical-500 to-medical-600 text-white px-8 py-4 rounded-full shadow-2xl hover:shadow-3xl transform hover:scale-105 transition font-bold text-lg">
                üíæ Salvar Tudo
            </button>
        </div>
    </div>

    <script>
        let coursesData = [];
        let currentConfig = {};

        // Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => {
                s.classList.remove('active');
                s.style.display = 'none';
            });
            
            // Show selected section
            const targetSection = document.getElementById(`section-${sectionName}`);
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.display = 'block';
            }
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        // Initialize first section as active
        document.addEventListener('DOMContentLoaded', function() {
            const firstSection = document.getElementById('section-global');
            if (firstSection) {
                firstSection.classList.add('active');
                firstSection.style.display = 'block';
            }
        });

        // Load configuration on page load
        window.addEventListener('DOMContentLoaded', loadConfiguration);

        async function loadConfiguration() {
            try {
                const response = await fetch('/api/bot/config');
                const data = await response.json();
                
                console.log('üì• Dados recebidos do servidor:', data);
                
                // O backend retorna { config: {...} }
                if (data.config && data.config.courses_config) {
                    currentConfig = typeof data.config.courses_config === 'string' 
                        ? JSON.parse(data.config.courses_config) 
                        : data.config.courses_config;
                    
                    console.log('‚úÖ Configura√ß√£o carregada:', currentConfig);
                    populateFields(currentConfig);
                } else if (data.config) {
                    // Se n√£o tem courses_config, criar estrutura inicial
                    console.log('‚ö†Ô∏è Nenhuma configura√ß√£o encontrada, criando padr√£o...');
                    currentConfig = createDefaultConfig();
                    populateFields(currentConfig);
                } else {
                    console.log('‚ÑπÔ∏è Primeira vez, sem configura√ß√£o');
                    currentConfig = createDefaultConfig();
                    populateFields(currentConfig);
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar:', error);
                showAlert('Erro ao carregar configura√ß√£o: ' + error.message, 'error');
            }
        }

        function createDefaultConfig() {
            return {
                bot_persona: {
                    name: 'Mia',
                    role: 'consultora de carreira da Trajet√≥ria Med',
                    company: 'Trajet√≥ria Med',
                    tone: 'Profissional, emp√°tico, persuasivo e objetivo'
                },
                menu_text: `Ol√°, Dr(a)! üëã
Sou a Mia, consultora da Trajet√≥ria Med!
Digite o n√∫mero da op√ß√£o desejada:

üìö *P√ìS-GRADUA√á√ïES:*
1Ô∏è‚É£ P√≥s em Auditoria em Sa√∫de
2Ô∏è‚É£ P√≥s em Medicina do Trabalho
3Ô∏è‚É£ P√≥s em Per√≠cia M√©dica Federal e Judicial
4Ô∏è‚É£ Combo Per√≠cia + Medicina do Trabalho

üéØ *PREPARAT√ìRIOS:*
5Ô∏è‚É£ Prova de T√≠tulo em Medicina Legal
6Ô∏è‚É£ Miss√£o M√©dico Legista (PC/PF)
7Ô∏è‚É£ SOS M√©dico Legista (Reta Final)
8Ô∏è‚É£ CAIXA (M√©dico do Trabalho)
9Ô∏è‚É£ TCE MG (Tribunal de Contas)`,
                courses: [
                    {
                        id: 'auditoria',
                        name: 'P√≥s em Auditoria em Sa√∫de',
                        salary: '',
                        exam_date: '',
                        registration_deadline: '',
                        subjects: '',
                        installment: '12x de R$ 227,22',
                        cash: 'R$ 2.197,00',
                        coupon: 'TRAJETORIA40',
                        payment_link_new: 'https://pay.kiwify.com.br/eQ5bDwh',
                        payment_link_alumni: 'https://pay.kiwify.com.br/wnX5sKi',
                        instagram_link: '',
                        flow_instructions: '',
                        intro_script: '',
                        closing_script: '',
                        objections: {
                            expensive: '',
                            no_time: '',
                            alone: '',
                            think: '',
                            final: ''
                        }
                    },
                    {
                        id: 'medicina',
                        name: 'P√≥s em Medicina do Trabalho',
                        salary: '',
                        exam_date: '',
                        registration_deadline: '',
                        subjects: '',
                        installment: '12x de R$ 227,22',
                        cash: 'R$ 2.197,00',
                        coupon: 'TRAJETORIA40',
                        payment_link_new: 'https://pay.kiwify.com.br/kQs5dRx',
                        payment_link_alumni: 'https://pay.kiwify.com.br/0Gu4DGE',
                        instagram_link: '',
                        flow_instructions: '',
                        intro_script: '',
                        closing_script: '',
                        objections: { expensive: '', no_time: '', alone: '', think: '', final: '' }
                    },
                    {
                        id: 'pericia',
                        name: 'P√≥s em Per√≠cia M√©dica Federal e Judicial',
                        salary: '',
                        exam_date: '',
                        registration_deadline: '',
                        subjects: '',
                        installment: '12x de R$ 227,22',
                        cash: 'R$ 2.197,00',
                        coupon: 'TRAJETORIA40',
                        payment_link_new: 'https://pay.kiwify.com.br/wUWMdZC',
                        payment_link_alumni: 'https://pay.kiwify.com.br/LjGbxhO',
                        instagram_link: '',
                        flow_instructions: '',
                        intro_script: '',
                        closing_script: '',
                        objections: { expensive: '', no_time: '', alone: '', think: '', final: '' }
                    },
                    {
                        id: 'combo',
                        name: 'Combo (Per√≠cia + Medicina + Auditoria)',
                        salary: '',
                        exam_date: '',
                        registration_deadline: '',
                        subjects: '',
                        installment: '12x de R$ 227,22',
                        cash: 'R$ 2.197,00',
                        coupon: 'TRAJETORIA40',
                        payment_link_new: 'https://pay.kiwify.com.br/G8D28l3',
                        payment_link_alumni: 'https://pay.kiwify.com.br/yv14Nj6',
                        instagram_link: '',
                        flow_instructions: '',
                        intro_script: '',
                        closing_script: '',
                        objections: { expensive: '', no_time: '', alone: '', think: '', final: '' }
                    },
                    {
                        id: 'provatitulos',
                        name: 'Prova de T√≠tulos em Medicina Legal',
                        salary: '',
                        exam_date: '',
                        registration_deadline: '',
                        subjects: '',
                        installment: '12x de R$ 227,22',
                        cash: 'R$ 2.197,00',
                        coupon: 'TRAJETORIA40',
                        payment_link_new: 'https://pay.kiwify.com.br/Wkh7JCu',
                        payment_link_alumni: 'https://pay.kiwify.com.br/lEWsLJm',
                        instagram_link: '',
                        flow_instructions: '',
                        intro_script: '',
                        closing_script: '',
                        objections: { expensive: '', no_time: '', alone: '', think: '', final: '' }
                    },
                    {
                        id: 'missao',
                        name: 'Miss√£o M√©dico Legista (PC/PF)',
                        salary: '',
                        exam_date: '',
                        registration_deadline: '',
                        subjects: '',
                        installment: '12x de R$ 227,22',
                        cash: 'R$ 2.197,00',
                        coupon: 'TRAJETORIA40',
                        payment_link_new: 'https://pay.kiwify.com.br/BgwBX4J',
                        payment_link_alumni: 'https://pay.kiwify.com.br/Mdi4c4N',
                        instagram_link: '',
                        flow_instructions: '',
                        intro_script: '',
                        closing_script: '',
                        objections: { expensive: '', no_time: '', alone: '', think: '', final: '' }
                    },
                    {
                        id: 'sos',
                        name: 'SOS M√©dico Legista (Reta Final)',
                        salary: '',
                        exam_date: '',
                        registration_deadline: '',
                        subjects: '',
                        installment: '12x de R$ 227,22',
                        cash: 'R$ 2.197,00',
                        coupon: 'TRAJETORIA40',
                        payment_link_new: 'https://pay.kiwify.com.br/XCLSRrI',
                        payment_link_alumni: 'https://pay.kiwify.com.br/fAl2qrg',
                        instagram_link: '',
                        flow_instructions: '',
                        intro_script: '',
                        closing_script: '',
                        objections: { expensive: '', no_time: '', alone: '', think: '', final: '' }
                    },
                    {
                        id: 'caixa',
                        name: 'CAIXA - M√©dico do Trabalho',
                        salary: 'R$ 12.371,00',
                        exam_date: '01/02/2026',
                        registration_deadline: 'at√© 08/12/2025 √†s 23h',
                        subjects: 'Medicina do Trabalho e temas relacionados',
                        qualification_requirements: 'RQE em Medicina do Trabalho ou 2 anos de experi√™ncia',
                        installment: '12x de R$ 227,22',
                        cash: 'R$ 2.197,00',
                        coupon: 'TRAJETORIA40',
                        payment_link_new: 'https://pay.kiwify.com.br/q0TTdIR',
                        payment_link_alumni: 'https://pay.kiwify.com.br/7aiBZMe',
                        instagram_link: '',
                        flow_instructions: '',
                        intro_script: '',
                        closing_script: '',
                        objections: { expensive: '', no_time: '', alone: '', think: '', final: '' }
                    },
                    {
                        id: 'tcemg',
                        name: 'TCE MG - Tribunal de Contas de Minas Gerais',
                        salary: 'R$ 15.000,00',
                        exam_date: '25/01/2026',
                        registration_deadline: 'at√© 09/12/2025',
                        subjects: 'P1: Portugu√™s, Racioc√≠nio L√≥gico, Inform√°tica, Dir. Constitucional, Dir. Administrativo | P2: Medicina Completa | P3: Discursiva',
                        qualification_requirements: 'Qualquer especialidade ou sem especialidade',
                        installment: '12x de R$ 227,22',
                        cash: 'R$ 2.197,00',
                        coupon: 'TRAJETORIA40',
                        payment_link_new: 'https://pay.kiwify.com.br/vxDfWrp',
                        payment_link_alumni: 'https://pay.kiwify.com.br/Jl2eYDO',
                        instagram_link: '',
                        flow_instructions: '',
                        intro_script: '',
                        closing_script: '',
                        objections: { expensive: '', no_time: '', alone: '', think: '', final: '' }
                    }
                ],
                business_rules: {
                    pix_key: 'contato@escoladepericiamedica.com.br',
                    access_message: 'O material ser√° liberado logo ap√≥s a confirma√ß√£o do pagamento'
                },
                objections: {
                    price: 'Dr(a), o sal√°rio inicial √© +12k com benef√≠cios. O valor do curso √© menor que um √∫nico plant√£o de 24h. √â um investimento para Sair dos plant√µes, n√£o um custo.',
                    time: 'Dr(a), o curso foi feito para quem d√° plant√£o. As aulas s√£o curtas, temos mapas mentais e cronograma para 1h a 2h por dia. Voc√™ precisa de dire√ß√£o, n√£o de tempo sobrando.',
                    alone: 'O problema √© filtrar o que estudar. Sozinho voc√™ perde tempo. A banca tem estilo pr√≥prio e n√≥s entregamos tudo mastigado, focado exatamente no que cai.',
                    think: 'Claro, Dr(a)! Mas lembre-se que as inscri√ß√µes s√£o at√© [DATA] e quanto antes come√ßar, mais preparado estar√°.',
                    final: 'Ent√£o deixamos para uma pr√≥xima oportunidade üòä. Aproveite e acesse nosso website: www.trajetoriamed.com.br'
                },
                advanced: {
                    message_buffer: 3,
                    additional_instructions: ''
                }
            };
        }

        function populateFields(config) {
            // Global - Persona
            if (config.bot_persona) {
                document.getElementById('bot_name').value = config.bot_persona.name || '';
                document.getElementById('bot_role').value = config.bot_persona.role || '';
                document.getElementById('bot_company').value = config.bot_persona.company || '';
                document.getElementById('bot_tone').value = config.bot_persona.tone || '';
            }

            // Menu
            if (config.menu_text) {
                document.getElementById('menu_text').value = config.menu_text;
            }

            // Business Rules
            if (config.business_rules) {
                const br = config.business_rules;
                document.getElementById('pix_key').value = br.pix_key || '';
                document.getElementById('access_message').value = br.access_message || '';
            }

            // Courses
            if (config.courses) {
                coursesData = config.courses;
                renderCoursesList();
                populateCourseSelectors();
            }

            // Scripts
            if (config.objections) {
                document.getElementById('objection_price').value = config.objections.price || '';
                document.getElementById('objection_time').value = config.objections.time || '';
                document.getElementById('objection_alone').value = config.objections.alone || '';
                document.getElementById('objection_think').value = config.objections.think || '';
                document.getElementById('objection_final').value = config.objections.final || '';
            }

            // Advanced
            if (config.advanced) {
                document.getElementById('message_buffer').value = config.advanced.message_buffer || 3;
                document.getElementById('ai_additional_instructions').value = config.advanced.additional_instructions || '';
            }
        }

        function renderCoursesList() {
            const container = document.getElementById('courses-list');
            container.innerHTML = coursesData.map((course, index) => `
                <div class="course-card border rounded-lg p-4 bg-gray-50">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">${course.name || 'Sem nome'}</h3>
                            <span class="text-sm text-gray-500">ID: ${course.id}</span>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editCourse(${index})" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                                ‚úèÔ∏è Editar
                            </button>
                            <button onclick="deleteCourse(${index})" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                                üóëÔ∏è Excluir
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-sm text-gray-600">
                        <div><strong>Sal√°rio:</strong> ${course.salary || 'N/A'}</div>
                        <div><strong>Prova:</strong> ${course.exam_date || 'N/A'}</div>
                        <div><strong>Parcelamento:</strong> ${course.installment || 'N/A'}</div>
                        <div><strong>√Ä Vista:</strong> ${course.cash || 'N/A'}</div>
                        <div><strong>Link New:</strong> ${course.payment_link_new ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>Link Alumni:</strong> ${course.payment_link_alumni ? '‚úÖ' : '‚ùå'}</div>
                    </div>
                </div>
            `).join('');
        }

        function populateCourseSelectors() {
            const flowSelector = document.getElementById('flow_course_selector');
            const scriptSelector = document.getElementById('script_course_selector');
            
            const options = coursesData.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            
            flowSelector.innerHTML = '<option value="">-- Selecione um curso --</option>' + options;
            scriptSelector.innerHTML = '<option value="">-- Selecione um curso --</option>' + options;
        }

        function loadFlowForCourse() {
            const courseId = document.getElementById('flow_course_selector').value;
            if (!courseId) {
                document.getElementById('flow-editor').classList.add('hidden');
                return;
            }
            
            const course = coursesData.find(c => c.id === courseId);
            if (course) {
                document.getElementById('flow-editor').classList.remove('hidden');
                document.getElementById('flow_instructions').value = course.flow_instructions || '';
            }
        }

        function saveFlowForCourse() {
            const courseId = document.getElementById('flow_course_selector').value;
            if (!courseId) {
                showAlert('Selecione um curso primeiro', 'error');
                return;
            }
            
            const course = coursesData.find(c => c.id === courseId);
            if (course) {
                course.flow_instructions = document.getElementById('flow_instructions').value;
                showAlert('Fluxo salvo com sucesso!', 'success');
                console.log('‚úÖ Fluxo salvo para', courseId, course.flow_instructions.substring(0, 100) + '...');
            }
        }

        function loadScriptsForCourse() {
            const courseId = document.getElementById('script_course_selector').value;
            if (!courseId) {
                document.getElementById('course-scripts-editor').classList.add('hidden');
                return;
            }
            
            const course = coursesData.find(c => c.id === courseId);
            if (course) {
                document.getElementById('course-scripts-editor').classList.remove('hidden');
                document.getElementById('course_intro_script').value = course.intro_script || '';
                document.getElementById('course_closing_script').value = course.closing_script || '';
                
                // Carregar obje√ß√µes espec√≠ficas do curso
                if (!course.objections) {
                    course.objections = { expensive: '', no_time: '', alone: '', think: '', final: '' };
                }
                document.getElementById('course_objection_expensive').value = course.objections.expensive || '';
                document.getElementById('course_objection_no_time').value = course.objections.no_time || '';
                document.getElementById('course_objection_alone').value = course.objections.alone || '';
                document.getElementById('course_objection_think').value = course.objections.think || '';
                document.getElementById('course_objection_final').value = course.objections.final || '';
            }
        }

        function saveScriptsForCourse() {
            const courseId = document.getElementById('script_course_selector').value;
            if (!courseId) {
                showAlert('Selecione um curso primeiro', 'error');
                return;
            }
            
            const course = coursesData.find(c => c.id === courseId);
            if (course) {
                course.intro_script = document.getElementById('course_intro_script').value;
                course.closing_script = document.getElementById('course_closing_script').value;
                
                // Salvar obje√ß√µes espec√≠ficas
                if (!course.objections) {
                    course.objections = {};
                }
                course.objections.expensive = document.getElementById('course_objection_expensive').value;
                course.objections.no_time = document.getElementById('course_objection_no_time').value;
                course.objections.alone = document.getElementById('course_objection_alone').value;
                course.objections.think = document.getElementById('course_objection_think').value;
                course.objections.final = document.getElementById('course_objection_final').value;
                
                showAlert('Scripts e obje√ß√µes salvos com sucesso!', 'success');
                console.log('‚úÖ Scripts e obje√ß√µes salvos para', courseId, course);
            }
        }

        function addNewCourse() {
            const newCourse = {
                id: 'curso_' + Date.now(),
                name: 'Novo Curso',
                salary: '',
                exam_date: '',
                registration_deadline: '',
                subjects: '',
                payment_link_new: '',
                payment_link_alumni: '',
                flow_instructions: '',
                intro_script: '',
                closing_script: ''
            };
            
            coursesData.push(newCourse);
            renderCoursesList();
            populateCourseSelectors();
        }

        function editCourse(index) {
            const course = coursesData[index];
            
            const modal = `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onclick="closeModal()">
                    <div class="bg-white rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                        <h3 class="text-2xl font-bold mb-4">Editar Curso</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">ID do Curso</label>
                                <input type="text" id="edit_course_id" value="${course.id}" class="w-full px-4 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Nome</label>
                                <input type="text" id="edit_course_name" value="${course.name}" class="w-full px-4 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Sal√°rio</label>
                                <input type="text" id="edit_course_salary" value="${course.salary || ''}" class="w-full px-4 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Data da Prova</label>
                                <input type="text" id="edit_course_exam" value="${course.exam_date || ''}" class="w-full px-4 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Link Novo Aluno</label>
                                <input type="url" id="edit_course_link_new" value="${course.payment_link_new || ''}" class="w-full px-4 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Link Ex-Aluno</label>
                                <input type="url" id="edit_course_link_alumni" value="${course.payment_link_alumni || ''}" class="w-full px-4 py-2 border rounded-lg">
                            </div>
                        </div>
                        
                        <div class="border-t pt-4 mt-4">
                            <h4 class="text-lg font-bold mb-3">üì± Link do Instagram</h4>
                            <div class="grid grid-cols-1 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">C√≥digo do Post (ex: DBN-_0xpJ3Z, DBN_0bSpX0K)</label>
                                    <input type="text" id="edit_course_instagram" value="${course.instagram_link || ''}" class="w-full px-4 py-2 border rounded-lg" placeholder="DBN-_0xpJ3Z, DBN_0bSpX0K">
                                    <small class="text-gray-500">Separe m√∫ltiplos c√≥digos por v√≠rgula. Bot detectar√° automaticamente quando usu√°rio clicar no link do Instagram.</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="border-t pt-4 mt-4">
                            <h4 class="text-lg font-bold mb-3">üí∞ Pre√ßos do Curso</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Parcelamento</label>
                                    <input type="text" id="edit_course_installment" value="${course.installment || ''}" class="w-full px-4 py-2 border rounded-lg" placeholder="12x de R$ 227,22">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">√Ä Vista</label>
                                    <input type="text" id="edit_course_cash" value="${course.cash || ''}" class="w-full px-4 py-2 border rounded-lg" placeholder="R$ 2.197,00">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Cupom</label>
                                    <input type="text" id="edit_course_coupon" value="${course.coupon || ''}" class="w-full px-4 py-2 border rounded-lg" placeholder="TRAJETORIA40">
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex gap-4 mt-4">
                            <button onclick="saveCourseEdit(${index})" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                                Salvar
                            </button>
                            <button onclick="closeModal()" class="bg-gray-400 text-white px-6 py-2 rounded-lg hover:bg-gray-500">
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        function saveCourseEdit(index) {
            coursesData[index] = {
                ...coursesData[index],
                id: document.getElementById('edit_course_id').value,
                name: document.getElementById('edit_course_name').value,
                salary: document.getElementById('edit_course_salary').value,
                exam_date: document.getElementById('edit_course_exam').value,
                payment_link_new: document.getElementById('edit_course_link_new').value,
                payment_link_alumni: document.getElementById('edit_course_link_alumni').value,
                instagram_link: document.getElementById('edit_course_instagram').value,
                installment: document.getElementById('edit_course_installment').value,
                cash: document.getElementById('edit_course_cash').value,
                coupon: document.getElementById('edit_course_coupon').value
            };
            
            renderCoursesList();
            populateCourseSelectors();
            closeModal();
        }

        function deleteCourse(index) {
            if (confirm('Tem certeza que deseja excluir este curso?')) {
                coursesData.splice(index, 1);
                renderCoursesList();
                populateCourseSelectors();
            }
        }

        function closeModal() {
            document.querySelectorAll('.fixed.inset-0').forEach(modal => modal.remove());
        }

        async function saveAllConfig() {
            try {
                console.log('üíæ Iniciando salvamento...');
                
                // Save flow instructions for selected course
                const flowCourseId = document.getElementById('flow_course_selector').value;
                if (flowCourseId) {
                    const course = coursesData.find(c => c.id === flowCourseId);
                    if (course) {
                        course.flow_instructions = document.getElementById('flow_instructions').value;
                        console.log(`‚úÖ Flow salvo para curso: ${flowCourseId}`);
                    }
                }

                // Save scripts for selected course
                const scriptCourseId = document.getElementById('script_course_selector').value;
                if (scriptCourseId) {
                    const course = coursesData.find(c => c.id === scriptCourseId);
                    if (course) {
                        course.intro_script = document.getElementById('course_intro_script').value;
                        course.closing_script = document.getElementById('course_closing_script').value;
                        console.log(`‚úÖ Scripts salvos para curso: ${scriptCourseId}`);
                    }
                }

                const fullConfig = {
                    bot_persona: {
                        name: document.getElementById('bot_name').value,
                        role: document.getElementById('bot_role').value,
                        company: document.getElementById('bot_company').value,
                        tone: document.getElementById('bot_tone').value
                    },
                    menu_text: document.getElementById('menu_text').value,
                    courses: coursesData,
                    business_rules: {
                        pix_key: document.getElementById('pix_key').value,
                        access_message: document.getElementById('access_message').value
                    },
                    objections: {
                        price: document.getElementById('objection_price').value,
                        time: document.getElementById('objection_time').value,
                        alone: document.getElementById('objection_alone').value,
                        think: document.getElementById('objection_think').value,
                        final: document.getElementById('objection_final').value
                    },
                    advanced: {
                        message_buffer: document.getElementById('message_buffer').value,
                        additional_instructions: document.getElementById('ai_additional_instructions').value
                    }
                };

                console.log('üì§ Configura√ß√£o a ser salva:', fullConfig);
                console.log('üìä Total de cursos:', fullConfig.courses.length);

                const response = await fetch('/api/bot/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ courses_config: fullConfig })
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ Resposta do servidor:', result);
                    
                    // Atualizar currentConfig com o que foi salvo
                    currentConfig = fullConfig;
                    
                    showAlert('‚úÖ Configura√ß√£o salva com sucesso!', 'success');
                } else {
                    const error = await response.json();
                    console.error('‚ùå Erro do servidor:', error);
                    throw new Error(error.error || 'Erro ao salvar configura√ß√£o');
                }
            } catch (error) {
                console.error('‚ùå Erro ao salvar:', error);
                showAlert('‚ùå Erro ao salvar: ' + error.message, 'error');
            }
        }

        function exportConfig() {
            const dataStr = JSON.stringify(currentConfig, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportName = `bot-config-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportName);
            linkElement.click();
        }

        function importConfig() {
            const file = document.getElementById('import_file').files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    currentConfig = imported;
                    populateFields(imported);
                    showAlert('‚úÖ Configura√ß√£o importada com sucesso!', 'success');
                } catch (error) {
                    showAlert('‚ùå Erro ao importar: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type === 'success' ? 'bg-green-100 text-green-800 border-green-300' : 'bg-red-100 text-red-800 border-red-300'} px-6 py-4 rounded-lg mb-4 border`;
            alertDiv.textContent = message;
            
            const container = document.getElementById('alert-container');
            container.innerHTML = '';
            container.appendChild(alertDiv);
            
            setTimeout(() => alertDiv.remove(), 5000);
        }
        
        // Detecta se est√° dentro de iframe e oculta sidebar
        if (window.self !== window.top) {
            // Est√° dentro de iframe
            const sidebar = document.querySelector('.w-72');
            const contentArea = document.querySelector('.flex-1');
            if (sidebar) sidebar.style.display = 'none';
            if (contentArea) {
                contentArea.style.width = '100%';
                contentArea.classList.remove('flex-1');
            }
        }
    </script>
            </div>
        </div>
    </div>
</body>
</html>
