â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     PROBLEMA: MENSAGENS NÃƒO ESTÃƒO CHEGANDO NO WEBHOOK         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DIAGNÃ“STICO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… Servidor estÃ¡ rodando (porta 3001)
âœ… Meta API configurada corretamente
âœ… Login funcionando
âŒ Webhook NÃƒO estÃ¡ recebendo mensagens

POSSÃVEIS CAUSAS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. âŒ Webhook nÃ£o estÃ¡ inscrito no nÃºmero de telefone
2. âŒ URL do webhook incorreta no Facebook
3. âŒ Webhook fields nÃ£o estÃ£o marcados
4. âŒ Firewall bloqueando requisiÃ§Ãµes da Meta

SOLUÃ‡ÃƒO PASSO A PASSO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PASSO 1: Verificar ConfiguraÃ§Ã£o do Webhook
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Acesse:
https://developers.facebook.com/apps/1115367907182650/whatsapp-business/wa-settings/

Verifique:

1. URL de Retorno de Chamada:
   âœ… Deve estar: http://165.22.158.58/api/meta/webhook
   
2. Token de VerificaÃ§Ã£o:
   âœ… Deve estar: TrajetoriaMed_Webhook_2025

3. Webhook Fields (Campos):
   âœ… messages - Deve estar MARCADO
   âœ… message_status - Deve estar MARCADO
   
4. Status da VerificaÃ§Ã£o:
   âœ… Deve mostrar um âœ“ verde

PASSO 2: Inscrever Webhook no NÃºmero
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CRÃTICO: O webhook precisa estar INSCRITO no nÃºmero de telefone!

1. Acesse a mesma pÃ¡gina:
   https://developers.facebook.com/apps/1115367907182650/whatsapp-business/wa-settings/

2. Role atÃ© a seÃ§Ã£o "Webhooks"

3. Procure por "Phone number" ou "NÃºmero de telefone"

4. Clique em "Gerenciar" ou "Manage"

5. Certifique-se de que o webhook estÃ¡ INSCRITO no nÃºmero:
   ğŸ“± +55 61 9903-3732 (ID: 858789420659191)

6. Se nÃ£o estiver, clique em "Inscrever" ou "Subscribe"

PASSO 3: Testar VerificaÃ§Ã£o do Webhook
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

No Facebook Developers, hÃ¡ um botÃ£o "Test" ou "Testar"

Clique nele e veja se aparece:
âœ… "Webhook verified successfully"

Se der erro:
âŒ Verifique se a URL estÃ¡ acessÃ­vel
âŒ Verifique se o token estÃ¡ correto

PASSO 4: URL Correta do Webhook
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš ï¸ IMPORTANTE: A URL deve ser acessÃ­vel pela internet!

URL CORRETA (HTTP):
http://165.22.158.58/api/meta/webhook

OU se tiver HTTPS configurado:
https://165.22.158.58/api/meta/webhook

âš ï¸ NÃƒO use:
âŒ http://localhost:3001/api/meta/webhook
âŒ http://165.22.158.58:3001/api/meta/webhook (com porta)

PASSO 5: Testar se o Webhook estÃ¡ AcessÃ­vel
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Abra no navegador:
http://165.22.158.58/api/meta/webhook-test

Deve mostrar:
{
  "status": "OK",
  "message": "Meta Webhook estÃ¡ funcionando!",
  "verifyToken": "Configurado"
}

Se nÃ£o funcionar:
âŒ Nginx nÃ£o estÃ¡ redirecionando corretamente
âŒ Servidor nÃ£o estÃ¡ acessÃ­vel externamente

PASSO 6: Verificar Logs do Webhook
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Execute no terminal:
ssh root@165.22.158.58 "pm2 logs wppbot --lines 0"

Depois envie uma mensagem WhatsApp para:
+55 61 9903-3732

VocÃª DEVE ver nos logs:
ğŸ“© Webhook de mensagem recebido
ğŸ“¨ Mensagem de [Nome] ([NÃºmero]): "[Texto]"

Se NÃƒO aparecer nada:
âŒ Webhook nÃ£o estÃ¡ inscrito no nÃºmero
âŒ Meta nÃ£o estÃ¡ conseguindo chamar sua URL

COMANDO PARA TESTAR (no seu PC):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Abra PowerShell e execute:
Invoke-WebRequest -Uri "http://165.22.158.58/api/meta/webhook-test"

Deve retornar status 200 e o JSON acima.

CHECKLIST FINAL:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[ ] Webhook URL configurada: http://165.22.158.58/api/meta/webhook
[ ] Token de verificaÃ§Ã£o: TrajetoriaMed_Webhook_2025
[ ] Webhook fields marcados: messages, message_status
[ ] Webhook INSCRITO no nÃºmero 858789420659191
[ ] URL acessÃ­vel pela internet (teste no navegador)
[ ] Nginx configurado para porta 3001
[ ] PM2 rodando na porta 3001

TESTE RÃPIDO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Acesse: http://165.22.158.58/api/meta/webhook-test
2. Veja logs: ssh root@165.22.158.58 "pm2 logs wppbot --lines 0"  
3. Envie mensagem WhatsApp para: +55 61 9903-3732
4. Veja se aparece nos logs

Se AINDA nÃ£o funcionar:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

VÃ¡ em:
https://developers.facebook.com/apps/1115367907182650/webhooks/

E clique em "Test" para ver se a Meta consegue chamar seu webhook.

IMPORTANTE:
O problema mais comum Ã© o webhook nÃ£o estar INSCRITO no nÃºmero!
Certifique-se de fazer a inscriÃ§Ã£o no painel do Facebook.
